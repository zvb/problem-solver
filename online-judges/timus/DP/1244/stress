g++ source.cpp -o source
g++ stupid.cpp -o stupid
g++ gen.cpp -o gen

while true; do
  ./gen > in
  ./stupid < in > out1.txt
  ./source < in > out2.txt
  if diff out1.txt out2.txt > /dev/null; then
    echo OK
  else
    echo ERROR
    break
  fi
done